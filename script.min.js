var playerName=0,jailtime_total=0,fine_total=0,bail_total=0,max_jailtime=480,max_fine=1e4,max_bail=25e3,addedChargeData=[],chargeData=[],foundedArrData=[];function viewData(){console.log("added charge index list on session");let e=JSON.parse(sessionStorage.getItem("addedCharge"));console.log(e),console.log("added charge index list"),console.log(addedChargeData),console.log("founded charge index list"),console.log(foundedArrData)}async function loadTableData(){let e=await fetch("data.json");chargeData=await e.json();let t=document.getElementById("chargeTableBody");if(t.innerHTML="",chargeData.forEach((e,a)=>{let l=splitChargeCode(e.charge).Code,n=linkHandler(l),d=splitChargeCode(e.charge).Charge,r=parseFloat(e.fine).toLocaleString("en-US",{style:"currency",currency:"USD"}),o=parseFloat(e.bail).toLocaleString("en-US",{style:"currency",currency:"USD"}),i=document.createElement("tr");i.innerHTML=`
            <td hidden translate="no" class=".added-index">${a}</td>
            <td hidden translate="no">${e.code}</td>
            <td translate="no" onclick="copyPureCharge(${a})" class="selectable-text" data-bs-toggle="tooltip" data-bs-placement="left" data-bs-title="Click to copy">${l}</td>
            <td translate="no">${d}${""===l?"":`
                <a href="https://police.san-andreas.net/viewtopic.php?t=148639#:~:text=${n}"target="_blank" rel="noopener noreferrer">
                    <i class="bi bi-link-45deg"></i>
                </a>
            `}
            </td>
            <td translate="no">${e.jailtime>0?e.jailtime:"-"}</td>
            <td translate="no">${e.fine>0?r:"-"}</td>
            <td translate="no">${e.bail>0?o:"-"}</td>
            <td><button onclick="AddCharge(${a})" class="btn btn-primary add-btn" id="add-btn-${a}">ADD</i></button></td>
        `,t.appendChild(i)}),initTooltip(),loadChargeTable(),null!==sessionStorage.getItem("s_playerName")){let a=document.getElementById("playerName");"0"===(playerName=sessionStorage.getItem("s_playerName"))?(sessionStorage.removeItem("s_playerName"),a.value=""):(a.value=playerName,updateName(playerName))}}function loadChargeTable(){if(null!==sessionStorage.getItem("addedCharge")){addedChargeData=JSON.parse(sessionStorage.getItem("addedCharge")),addedChargeData=[...new Set(addedChargeData)];for(let e=0;e<addedChargeData.length;e++){let t=addedChargeData[e];AddCharge(t,!1)}}}function AddCharge(e,t=!0){if(!Number.isInteger(e))throw Error("'index' are only accepting 'integer'.");if(document.getElementById("add-btn-"+e).disabled=!0,!0===t){for(let a=0;a<addedChargeData.length;a++)if(addedChargeData[a]===e){console.log("Data sudah ada di tabel seleksi.");return}addedChargeData.push(e);let l=JSON.stringify(addedChargeData=[...new Set(addedChargeData)]);sessionStorage.setItem("addedCharge",l)}let n=chargeData[e],d=document.getElementById("selectedChargeTableBody"),r=document.createElement("tr"),o=splitChargeCode(n.charge).Code,i=splitChargeCode(n.charge).Charge,c=parseFloat(n.fine).toLocaleString("en-US",{style:"currency",currency:"USD"}),s=parseFloat(n.bail).toLocaleString("en-US",{style:"currency",currency:"USD"});r.innerHTML=`
        <td translate="no" class="index" hidden>${e}</td>
        <td translate="no" onclick="copyPureCharge(${e})" class="selectable-text" data-bs-toggle="tooltip" data-bs-placement="left" data-bs-title="Click to copy">${o}</td>
        <td translate="no" id="charge-${e}" onclick="copyCharge(${e})" class="selectable-text charge-td" title="${n.charge}">${i}</td>
        <td translate="no" class="jailtime">${jailtimeInfo(e)}</td>
        <td translate="no" class="fine">${n.fine>0?c:"-"}</td>
        <td translate="no" class="bail">${n.bail>0?s:"-"}</td>
        <td><button onclick="copyCharge(${e})" class="btn btn-secondary">COPY</button></td>
        <td><button onclick="removeCharge(this, '${e}')" class="btn btn-danger">REMOVE</button></td>
    `,d.appendChild(r),refreshCalculation(),initNewTooltips()}async function removeCharge(e,t){let a=parseInt(t),l=addedChargeData.filter(e=>e!==a);if(l.length>0){let n=JSON.stringify(l);sessionStorage.setItem("addedCharge",n),addedChargeData=l}else sessionStorage.removeItem("addedCharge"),addedChargeData=[];document.getElementById("add-btn-"+t).disabled=!1;let d=e.closest("tr");d.remove(),await refreshCalculation()}function resetCharge(){let e=document.querySelectorAll(".add-btn");e.forEach(function(e){!0===e.disabled&&(e.disabled=!1)}),addedChargeData=[],sessionStorage.removeItem("addedCharge");let t=document.getElementById("selectedChargeTableBody");t.innerHTML="",refreshCalculation()}async function refreshCalculation(){jailtime_total=0,fine_total=0,bail_total=0;for(let e=0;e<addedChargeData.length;e++){let t=chargeData[addedChargeData[e]];t.jailtime>0&&(jailtime_total+=t.jailtime,fine_total+=t.fine,bail_total+=t.bail)}jailtime_total>max_jailtime&&(jailtime_total=max_jailtime),document.getElementById("jailtime-total").textContent=jailtime_total,fine_total>max_fine&&(fine_total=max_fine),document.getElementById("fine-total").textContent=`${fine_total.toLocaleString("en-US",{style:"currency",currency:"USD"})}`,bail_total>max_bail&&(bail_total=max_bail),document.getElementById("bail-total").textContent=`${bail_total.toLocaleString("en-US",{style:"currency",currency:"USD"})}`,jailtime_total>60?document.getElementById("location-tag").innerHTML='<span style="cursor: default" class="w-100 fs-6 btn btn-info text-bg-info fw-semibold">SACF</span>':document.getElementById("location-tag").innerHTML="";let a=`/arrest ${playerName} ${jailtime_total} ${fine_total} ${bail_total}`;if(document.getElementById("arrest-command").textContent=a,addedChargeData.length>0){let l=`(${addedChargeData.length})`;document.getElementById("charge-total").textContent=l}else document.getElementById("charge-total").textContent=""}function updateName(e){playerName="string"==typeof e?e.replace(/ /g,"_"):e,sessionStorage.setItem("s_playerName",playerName);let t=`/arrest ${playerName} ${jailtime_total} ${fine_total} ${bail_total}`;document.getElementById("arrest-command").textContent=t}function copyCharge(e){let t=document.getElementById(`charge-${e}`),a=chargeData[e],l="";l=0===a.jailtime&&a.fine>0?`/ticket ${playerName} ${a.fine} ${a.charge}`:`/su ${playerName} ${a.charge}`;let n=document.createElement("textarea");n.value=l,document.body.appendChild(n),n.select();try{document.execCommand("copy"),t.classList.add("text-secondary-emphasis")}catch(d){console.error("Failed to copy text",d)}document.body.removeChild(n)}function copyPureCharge(e){let t=chargeData[e],a=document.createElement("textarea");a.value=t.charge,document.body.appendChild(a),a.select();try{document.execCommand("copy")}catch(l){alert("Failed to copy text",l)}document.body.removeChild(a)}function copyArrestCMD(){let e=document.getElementById("arrest-command").innerText.trim(),t=document.createElement("textarea");t.value=e,document.body.appendChild(t),t.select();try{document.execCommand("copy")}catch(a){alert("Failed to copy text",a)}document.body.removeChild(t)}function copyChargeCode(){let e=[];for(let t=0;t<addedChargeData.length;t++){let a=chargeData[addedChargeData[t]];e.push(a.code)}let l=e.join(", "),n=document.createElement("textarea");n.value=l,document.body.appendChild(n),n.select();try{document.execCommand("copy")}catch(d){alert("Failed to copy text",d)}document.body.removeChild(n)}function splitChargeCode(e){let t=e.lastIndexOf(".");if(-1===t)return{Code:"",Charge:e.trim()};{let a=e.substring(0,t+1).trim(),l=e.substring(t+1).trim(),n=a.lastIndexOf(".");return -1!==n&&(a=a.substring(0,n)+a.substring(n+1)),{Code:a,Charge:l}}}function jailtimeInfo(e){let t=chargeData[e];return 0===t.jailtime&&t.fine>0?'<span class="badge text-bg-secondary mt-2">TICKET</span>':0===t.jailtime&&0===t.fine?'<span class="badge text-bg-secondary mt-2">TAG</span>':t.jailtime}function addAllFoundedCharge(){if(foundedArrData.length>0)for(let e=0;e<foundedArrData.length;e++)null!==chargeData[foundedArrData[e]]&&AddCharge(parseInt(foundedArrData[e]))}function linkHandler(e){let t=e.match(/\(1\)\sA/);return t||e}function initTooltip(){let e=document.querySelectorAll('[data-bs-toggle="tooltip"]');[...e].map(e=>new bootstrap.Tooltip(e)),e.forEach(function(e){e.addEventListener("click",function(){if("Click to copy"!==e.getAttribute("data-bs-title"))return;e.setAttribute("data-bs-title","Copied!");let t=bootstrap.Tooltip.getInstance(e);t.dispose(),(t=new bootstrap.Tooltip(e)).show(),setTimeout(function(){e.setAttribute("data-bs-title","Click to copy"),t.dispose(),t=new bootstrap.Tooltip(e)},3e3)})})}function initNewTooltips(){let e=document.querySelectorAll('[data-bs-toggle="tooltip"]:not([data-tooltip-initialized="true"])');[...e].map(e=>(e.setAttribute("data-tooltip-initialized","true"),new bootstrap.Tooltip(e))),e.forEach(function(e){e.addEventListener("click",function(){if("Click to copy"!==e.getAttribute("data-bs-title"))return;e.setAttribute("data-bs-title","Copied!");let t=bootstrap.Tooltip.getInstance(e);t.dispose(),(t=new bootstrap.Tooltip(e)).show(),setTimeout(function(){e.setAttribute("data-bs-title","Click to copy"),t.dispose(),t=new bootstrap.Tooltip(e)},3e3)})})}document.addEventListener("DOMContentLoaded",loadTableData),document.addEventListener("DOMContentLoaded",function(){let e=document.getElementById("playerName");e.addEventListener("input",function(){let t=e.value.trim();""===t&&(t=0,sessionStorage.removeItem("s_playerName")),updateName(t)})}),document.addEventListener("DOMContentLoaded",function(){let e=document.getElementById("searchInput"),t=document.getElementById("chargeTableBody"),a=t.getElementsByTagName("tr"),l=document.getElementById("chargeTableFooter");e.addEventListener("input",function(){let t=e.value.toLowerCase().trim(),n=t.replace(/\s/g,"").replace(/\./g,"");n=(n=n.split(",")).filter(e=>/^\d/.test(e)),l.hidden=!0,foundedArrData=[];for(let d=0;d<a.length;d++){let r=a[d].cells[0].textContent||a[d].cells[0].innerText,o=a[d].cells[1].textContent||a[d].cells[1].innerText,i=a[d].cells[2].textContent||a[d].cells[2].innerText,c=a[d].cells[3].textContent||a[d].cells[3].innerText,s=!1;if(n.length>1){for(let g=0;g<n.length&&!(foundedArrData.length>=20);g++)if(o.toLowerCase().indexOf(n[g].toLowerCase())>-1){s=!0,foundedArrData.push(parseInt(r));break}}s?(a[d].style.display="",l.hidden=!1):o.toLowerCase().indexOf(t)>-1||i.toLowerCase().indexOf(t)>-1||c.toLowerCase().indexOf(t)>-1?a[d].style.display="":a[d].style.display="none"}})}),document.addEventListener("DOMContentLoaded",function(){let e=document.getElementById("searchInput"),t=document.getElementById("playerName");document.addEventListener("keydown",a=>{a.ctrlKey&&"k"===a.key&&(a.preventDefault(),e.focus()),a.ctrlKey&&"s"===a.key&&(a.preventDefault(),t.focus())}),$(window).scroll(function(){$(this).scrollTop()>100?$("#back-to-top").fadeIn():$("#back-to-top").fadeOut()}),$("#back-to-top").click(function(){return $("html, body").animate({scrollTop:0},0),!1})});